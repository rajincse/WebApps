<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Heatmap</title>
        <link href="http://www.cs.fiu.edu/images/scislogo.png" rel="shortcut icon">
        <meta charset="UTF-8">        
        <script src="http://d3js.org/d3.v3.min.js"></script> 
        <script src="js/constants.js" type="text/javascript"></script>
        <script src="js/inputdb.js" type="text/javascript"></script>
        <script src="js/color.js" type="text/javascript"></script>
        <script src="js/handlers.js" type="text/javascript"></script>
        
        <link href="css/main.css" rel="stylesheet" type="text/css"/>
    </head>
    <body>
        <div><h1>Heatmap Analysis</h1></div>
        <div>
            <select id='dataSelection'>
                <option value="" selected>None</option>
                <option value="sampledata250.JSON">sampledata 250ms</option>      
                <option value="sampledata500.JSON">sampledata 500ms</option>
                <option value="Alexia250.JSON">Alexia 250ms</option>
                <option value="Alexia500.JSON">Alexia 500ms</option>
                <option value="Erika250.JSON">Erika 250ms</option>
                <option value="Erika500.JSON">Erika 500ms</option>
                <option value="Jasmin250.JSON">Jasmin 250ms</option>
                <option value="Jasmin500.JSON">Jasmin 500ms</option>
                <option value="Maria250.JSON">Maria 250ms</option>
                <option value="Maria500.JSON">Maria 500ms</option>
                <option value="Pedro250.JSON">Pedro 250ms</option>
                <option value="Pedro500.JSON">Pedro 500ms</option>
              </select>
            
        </div>
        
        <div class="container">
            
        </div>
         
        <div class="selected-content" style="visibility:hidden">
            <div class="selected-content-title">DOI info</div>
            <div class="label">Type:</div>
            <div class="type small-font"></div>
            <div class="label">Flow:</div>
            <div class="navigation-text small-font"></div>
            <div class="label ">Type Text:</div>
            <div class="type-text small-font"></div>
            <div class="label data-content">Text:</div>
            <div class="data-text small-font"></div>
            <div class="media-image">
                <svg class="media-image-svg" width="500" >
                </svg>
            </div>
        </div>
        <div id='loading' style="display: none">
            <img src="images/loading_spinner.gif" alt=""/>
        </div>
        <script>
            
            inputdb.load();
            
            
            var svg = d3.select(".container").append("svg")
                    .attr("id", "mainsvg")
                    .attr("width", mainSVGwidth)
                    .attr("height", mainSVGheight)
                    .attr('class','main-svg')
                    .on('click', onSvgClick)
                ;
            
            
            d3.select('#dataSelection')
                    .on('change', function(){ 
                        if(this.value)
                        {
                            d3.select('#loading').style('display','block');
                            d3.select('.container').style('display','none');
                            d3.json("data/"+this.value, function (error, data) {
                                if (error)
                                    throw error;
                                
                              
                               render(data);
                               d3.select('#loading').style('display','none');
                               d3.select('.container').style('display','block');

                            });
                        }
                        else
                        {
                            initialize();
                        }
                    }
                );
             
            function initialize()
            {
               d3.select("svg").selectAll('.removable').remove();
               zoomListener.scale(1);
               zoomListener.translate([0,0]);
                d3.select('.selected-content')
                                        .style('visibility','hidden');
            }
            function render( data)
            {
                initialize();
                
                var zoomContainer = d3.select("svg").append('g')
                                .attr('id','zoomContainer')
                                .attr('class', 'removable')    
                                
                                .call(zoomListener);
                var baseGroup =zoomContainer.append('g')
                                .attr('id','base')
                    ;
                var heatmapGroup = baseGroup
                    .append('g')
                    .attr('id','heatmap')
                    .attr('transform','translate('+labelRectWidth+',0)')
                    .call(drag)
                ;
                var labelRectGroup = baseGroup.append('g')
                        .attr('id','labelRect')
                    ;
                
                var labelTextGroup = baseGroup.append('g')
                        .attr('id','labelText')
                    ;
                
                var hoverRectGroup = baseGroup.append('g')
                        .attr('id','hoverRect')
                        
                ;
                
                labelRectGroup.selectAll('rect').data(data.entryList)
                        .enter()
                        .insert('rect')
                        .attr('id', function(d,i){ return 'labelrect-'+i;})
                        .attr("x", function(d){ return cellWidth;})
                        .attr("y", function(d, j){ return j* cellHeight;})
                        .attr('width', labelRectWidth)
                        .attr('height',cellHeight)
                        .style({fill:function(d)
                                    { 
                                       return Color.getColorFromType(d.dataObject).getColorString();
                                    }
                                ,'stroke-width':1,stroke:'rgb(225,225,225)', 'fill-opacity':0.75})
                        .on('mouseover', onMouseOver)
                        .on('mouseout', onMouseOut)
                        .on('dblclick', onClick )
                        .append("svg:title")
                        .text(function(d) { return d.dataObject.label; })
                            ;
                            
                heatmapGroup.selectAll('image').data(data.entryList)
                        .enter()
                        .insert('svg:image')
                        .attr("xlink:href",function(d){return "data/"+d.imagePath;})
                        .attr('id', function(d,i){ return 'heatmapImage-'+i;})
                        .attr("x", function(d){ return cellWidth;})
                        .attr("y", function(d, j){ return j* cellHeight;})                          
                        .attr('width', data.totalCells * cellWidth)
                        .attr('height', cellHeight)
                        .on('mouseover', onMouseOver)
                        .on('mouseout', onMouseOut)
                        .on('dblclick', onClick )
                    
                        .append("svg:title")
                        .text(function(d) { return d.dataObject.label; })
                ;
                
                labelTextGroup.selectAll('text').data(data.entryList)
                        .enter()
                        .insert("text")
                        .attr('id', function(d,i){ return 'text-'+i;})
                        .text(function(d) { 
                            var id = d.dataObject.label;
                            var label = inputdb.getLabel(id);
                            return label; 
                        })
                        .attr("x", function(d){ return cellWidth;})
                        .attr("y", function(d, j){ return (j+1)* cellHeight;})                        
                        .attr('font-family',"Verdana")
                        .attr('font-size','10')
                        .on('mouseover', onMouseOver)
                        .on('mouseout', onMouseOut)
                        .on('dblclick', onClick )
                        .append("svg:title")
                        .text(function(d) { return d.dataObject.label; })
                ;
                
                hoverRectGroup.selectAll('rect').data(data.entryList)
                        .enter()
                        .insert('rect')
                        .attr('id', function(d,j){ return 'hover-'+j;})
                        .attr("x", function(d){ return cellWidth;})
                        .attr("y", function(d, j){ return j* cellHeight;})
                        .attr('width', labelRectWidth+data.totalCells * cellWidth)
                        .attr('height',cellHeight)
                        .style({fill:'none',stroke:'rgb(125,125,125)', 'stroke-opacity':1, 'visibility':'hidden'})
                        ;
            }
             </script>
       
        
    </body>
</html>
