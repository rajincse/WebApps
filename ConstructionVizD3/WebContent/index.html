<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Construction Viz</title>
<link href="images/favicon.ico" rel="shortcut icon">
<script type="text/javascript" src="js/constants.js"></script>
<script type="text/javascript" src="js/Utility.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script type="text/javascript" src="js/myscript.js"></script>
<!-- <script type="text/javascript" src="js/renderCameraDistance.js"></script> -->
<script type="text/javascript" src="js/renderScarfPlot.js"></script>
<script type="text/javascript" src="js/contextRendering.js"></script>
<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
<button id="zoomIn">zoom+</button>
	<button id="zoomOut">zoom-</button>
<div id='controlDiv'>
	
	
	<select id='sortingProperties'>
		<option value="none" class='prexist' selected>count</option>
	</select>
	<select id='sortingAscending'>
	 	<option value='true' selected>Ascending</option>
	 	<option value='false'>Descending</option>
	</select>
	<div>
		Min:<input type='text' id='filterMin'value='0' class='filter-input'>
		Max:<input type='text' id='filterMax' value='1' class='filter-input'>
	</div>
	
	<button id="render">Render</button>
</div>
<div id="status"></div>
<div class='parent-container'>
	<div class="container">
		<svg id='mainSVG'>
		</svg>
	</div>
	<div class="container">
		<svg id='legendSVG'>
			
		</svg>
	</div>
</div>




<script type="text/javascript">
loadData();

d3.select('#render').on('click', function(){	
	render();
});

d3.select('#sortingProperties')
	.selectAll('option.added')
	.data(Object.keys(displayProperties))
	.enter()
	.append('option')
	.append('class', 'added')
	.attr('value', function(d){ return d;})
	.text( function(d){ return d;});

function getSelectedProperty()
{
	var sortingPropertySelect = document.getElementById('sortingProperties');		
	var sortingProperty = sortingPropertySelect.options[sortingPropertySelect.selectedIndex].value;
	// For Count, sortingProperty is undefined. 
	if(sortingProperty === 'none') {
		sortingProperty = undefined;
	}
	return sortingProperty;
}
function getSortingOrder()
{
	var  sortAscendingSelect = document.getElementById('sortingAscending');
	var  sortAscendingString= sortAscendingSelect.options[sortAscendingSelect.selectedIndex].value;
	var sortAscending = (sortAscendingString === 'true');
	return sortAscending;
}
function render()
{
	var dataLength = Object.keys(mainData).length;
	
	if(dataLength > 0)
	{
		d3.select('#status').text('OK');
		
		d3.select('#mainSVG').selectAll('*').remove();
		d3.select('#legendSVG').selectAll('*').remove();		
				
		var sortingProperty = getSelectedProperty();		
		
		var  sortAscending= getSortingOrder();
		
		var filterMin = document.getElementById("filterMin").value;
		var filterMax = document.getElementById("filterMax").value;
		var filter ={min:parseFloat(filterMin), max : parseFloat(filterMax)}
		contextRendering(sortingProperty, sortAscending,filter);
		renderGlyphGuide();
	}
	else
	{
		d3.select('#status').text('Try Again');
	}
}




</script>


</body>
</html>